"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeXML=exports.decodeHTMLStrict=exports.decodeHTML=exports.determineBranch=exports.BinTrieFlags=exports.fromCodePoint=exports.replaceCodePoint=exports.decodeCodePoint=exports.xmlDecodeTree=exports.htmlDecodeTree=void 0;var decode_data_html_js_1=__importDefault(require("./generated/decode-data-html.js"));exports.htmlDecodeTree=decode_data_html_js_1.default;var decode_data_xml_js_1=__importDefault(require("./generated/decode-data-xml.js"));exports.xmlDecodeTree=decode_data_xml_js_1.default;var decode_codepoint_js_1=__importDefault(require("./decode_codepoint.js"));exports.decodeCodePoint=decode_codepoint_js_1.default;var CharCodes,BinTrieFlags,decode_codepoint_js_2=require("./decode_codepoint.js");function getDecoder(e){return function(r,o){for(var d="",t=0,a=0;(a=r.indexOf("&",a))>=0;)if(d+=r.slice(t,a),t=a,a+=1,r.charCodeAt(a)!==CharCodes.NUM){for(var i=0,_=1,c=0,n=e[c];a<r.length&&!((c=determineBranch(e,n,c+1,r.charCodeAt(a)))<0);a++,_++){var s=(n=e[c])&BinTrieFlags.VALUE_LENGTH;if(s){var l;if(o&&r.charCodeAt(a)!==CharCodes.SEMI||(i=c,_=0),0===(l=(s>>14)-1))break;c+=l}}if(0!==i)d+=1===(l=(e[i]&BinTrieFlags.VALUE_LENGTH)>>14)?String.fromCharCode(e[i]&~BinTrieFlags.VALUE_LENGTH):2===l?String.fromCharCode(e[i+1]):String.fromCharCode(e[i+1],e[i+2]),t=a-_+1}else{var C=a+1,f=10,u=r.charCodeAt(C);(u|CharCodes.To_LOWER_BIT)===CharCodes.LOWER_X&&(f=16,a+=1,C+=1);do{u=r.charCodeAt(++a)}while(u>=CharCodes.ZERO&&u<=CharCodes.NINE||16===f&&(u|CharCodes.To_LOWER_BIT)>=CharCodes.LOWER_A&&(u|CharCodes.To_LOWER_BIT)<=CharCodes.LOWER_F);if(C!==a){var T=r.substring(C,a),p=parseInt(T,f);if(r.charCodeAt(a)===CharCodes.SEMI)a+=1;else if(o)continue;d+=(0,decode_codepoint_js_1.default)(p),t=a}}return d+r.slice(t)}}function determineBranch(e,r,o,d){var t=(r&BinTrieFlags.BRANCH_LENGTH)>>7,a=r&BinTrieFlags.JUMP_TABLE;if(0===t)return 0!==a&&d===a?o:-1;if(a){var i=d-a;return i<0||i>=t?-1:e[o+i]-1}for(var _=o,c=_+t-1;_<=c;){var n=_+c>>>1,s=e[n];if(s<d)_=n+1;else{if(!(s>d))return e[n+t];c=n-1}}return-1}Object.defineProperty(exports,"replaceCodePoint",{enumerable:!0,get:function(){return decode_codepoint_js_2.replaceCodePoint}}),Object.defineProperty(exports,"fromCodePoint",{enumerable:!0,get:function(){return decode_codepoint_js_2.fromCodePoint}}),function(e){e[e.NUM=35]="NUM",e[e.SEMI=59]="SEMI",e[e.ZERO=48]="ZERO",e[e.NINE=57]="NINE",e[e.LOWER_A=97]="LOWER_A",e[e.LOWER_F=102]="LOWER_F",e[e.LOWER_X=120]="LOWER_X",e[e.To_LOWER_BIT=32]="To_LOWER_BIT"}(CharCodes||(CharCodes={})),function(e){e[e.VALUE_LENGTH=49152]="VALUE_LENGTH",e[e.BRANCH_LENGTH=16256]="BRANCH_LENGTH",e[e.JUMP_TABLE=127]="JUMP_TABLE"}(BinTrieFlags=exports.BinTrieFlags||(exports.BinTrieFlags={})),exports.determineBranch=determineBranch;var htmlDecoder=getDecoder(decode_data_html_js_1.default),xmlDecoder=getDecoder(decode_data_xml_js_1.default);function decodeHTML(e){return htmlDecoder(e,!1)}function decodeHTMLStrict(e){return htmlDecoder(e,!0)}function decodeXML(e){return xmlDecoder(e,!0)}exports.decodeHTML=decodeHTML,exports.decodeHTMLStrict=decodeHTMLStrict,exports.decodeXML=decodeXML;
