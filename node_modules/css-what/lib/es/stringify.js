import{SelectorType,AttributeAction}from"./types";const attribValChars=["\\",'"'],pseudoValChars=[...attribValChars,"(",")"],charsToEscapeInAttributeValue=new Set(attribValChars.map((e=>e.charCodeAt(0)))),charsToEscapeInPseudoValue=new Set(pseudoValChars.map((e=>e.charCodeAt(0)))),charsToEscapeInName=new Set([...pseudoValChars,"~","^","$","*","+","!","|",":","[","]"," ","."].map((e=>e.charCodeAt(0))));export function stringify(e){return e.map((e=>e.map(stringifyToken).join(""))).join(", ")}function stringifyToken(e,a,t){switch(e.type){case SelectorType.Child:return 0===a?"> ":" > ";case SelectorType.Parent:return 0===a?"< ":" < ";case SelectorType.Sibling:return 0===a?"~ ":" ~ ";case SelectorType.Adjacent:return 0===a?"+ ":" + ";case SelectorType.Descendant:return" ";case SelectorType.ColumnCombinator:return 0===a?"|| ":" || ";case SelectorType.Universal:return"*"===e.namespace&&a+1<t.length&&"name"in t[a+1]?"":`${getNamespace(e.namespace)}*`;case SelectorType.Tag:return getNamespacedName(e);case SelectorType.PseudoElement:return`::${escapeName(e.name,charsToEscapeInName)}${null===e.data?"":`(${escapeName(e.data,charsToEscapeInPseudoValue)})`}`;case SelectorType.Pseudo:return`:${escapeName(e.name,charsToEscapeInName)}${null===e.data?"":`(${"string"==typeof e.data?escapeName(e.data,charsToEscapeInPseudoValue):stringify(e.data)})`}`;case SelectorType.Attribute:{if("id"===e.name&&e.action===AttributeAction.Equals&&"quirks"===e.ignoreCase&&!e.namespace)return`#${escapeName(e.value,charsToEscapeInName)}`;if("class"===e.name&&e.action===AttributeAction.Element&&"quirks"===e.ignoreCase&&!e.namespace)return`.${escapeName(e.value,charsToEscapeInName)}`;const a=getNamespacedName(e);return e.action===AttributeAction.Exists?`[${a}]`:`[${a}${getActionValue(e.action)}="${escapeName(e.value,charsToEscapeInAttributeValue)}"${null===e.ignoreCase?"":e.ignoreCase?" i":" s"}]`}}}function getActionValue(e){switch(e){case AttributeAction.Equals:return"";case AttributeAction.Element:return"~";case AttributeAction.Start:return"^";case AttributeAction.End:return"$";case AttributeAction.Any:return"*";case AttributeAction.Not:return"!";case AttributeAction.Hyphen:return"|";case AttributeAction.Exists:throw new Error("Shouldn't be here")}}function getNamespacedName(e){return`${getNamespace(e.namespace)}${escapeName(e.name,charsToEscapeInName)}`}function getNamespace(e){return null!==e?`${"*"===e?"*":escapeName(e,charsToEscapeInName)}|`:""}function escapeName(e,a){let t=0,r="";for(let n=0;n<e.length;n++)a.has(e.charCodeAt(n))&&(r+=`${e.slice(t,n)}\\${e.charAt(n)}`,t=n+1);return r.length>0?r+e.slice(t):e}
