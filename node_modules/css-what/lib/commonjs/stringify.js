"use strict";var __spreadArray=this&&this.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var r,c=0,n=t.length;c<n;c++)!r&&c in t||(r||(r=Array.prototype.slice.call(t,0,c)),r[c]=t[c]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.stringify=void 0;var types_1=require("./types"),attribValChars=["\\",'"'],pseudoValChars=__spreadArray(__spreadArray([],attribValChars,!0),["(",")"],!1),charsToEscapeInAttributeValue=new Set(attribValChars.map((function(e){return e.charCodeAt(0)}))),charsToEscapeInPseudoValue=new Set(pseudoValChars.map((function(e){return e.charCodeAt(0)}))),charsToEscapeInName=new Set(__spreadArray(__spreadArray([],pseudoValChars,!0),["~","^","$","*","+","!","|",":","[","]"," ","."],!1).map((function(e){return e.charCodeAt(0)})));function stringify(e){return e.map((function(e){return e.map(stringifyToken).join("")})).join(", ")}function stringifyToken(e,t,a){switch(e.type){case types_1.SelectorType.Child:return 0===t?"> ":" > ";case types_1.SelectorType.Parent:return 0===t?"< ":" < ";case types_1.SelectorType.Sibling:return 0===t?"~ ":" ~ ";case types_1.SelectorType.Adjacent:return 0===t?"+ ":" + ";case types_1.SelectorType.Descendant:return" ";case types_1.SelectorType.ColumnCombinator:return 0===t?"|| ":" || ";case types_1.SelectorType.Universal:return"*"===e.namespace&&t+1<a.length&&"name"in a[t+1]?"":"".concat(getNamespace(e.namespace),"*");case types_1.SelectorType.Tag:return getNamespacedName(e);case types_1.SelectorType.PseudoElement:return"::".concat(escapeName(e.name,charsToEscapeInName)).concat(null===e.data?"":"(".concat(escapeName(e.data,charsToEscapeInPseudoValue),")"));case types_1.SelectorType.Pseudo:return":".concat(escapeName(e.name,charsToEscapeInName)).concat(null===e.data?"":"(".concat("string"==typeof e.data?escapeName(e.data,charsToEscapeInPseudoValue):stringify(e.data),")"));case types_1.SelectorType.Attribute:if("id"===e.name&&e.action===types_1.AttributeAction.Equals&&"quirks"===e.ignoreCase&&!e.namespace)return"#".concat(escapeName(e.value,charsToEscapeInName));if("class"===e.name&&e.action===types_1.AttributeAction.Element&&"quirks"===e.ignoreCase&&!e.namespace)return".".concat(escapeName(e.value,charsToEscapeInName));var r=getNamespacedName(e);return e.action===types_1.AttributeAction.Exists?"[".concat(r,"]"):"[".concat(r).concat(getActionValue(e.action),'="').concat(escapeName(e.value,charsToEscapeInAttributeValue),'"').concat(null===e.ignoreCase?"":e.ignoreCase?" i":" s","]")}}function getActionValue(e){switch(e){case types_1.AttributeAction.Equals:return"";case types_1.AttributeAction.Element:return"~";case types_1.AttributeAction.Start:return"^";case types_1.AttributeAction.End:return"$";case types_1.AttributeAction.Any:return"*";case types_1.AttributeAction.Not:return"!";case types_1.AttributeAction.Hyphen:return"|";case types_1.AttributeAction.Exists:throw new Error("Shouldn't be here")}}function getNamespacedName(e){return"".concat(getNamespace(e.namespace)).concat(escapeName(e.name,charsToEscapeInName))}function getNamespace(e){return null!==e?"".concat("*"===e?"*":escapeName(e,charsToEscapeInName),"|"):""}function escapeName(e,t){for(var a=0,r="",c=0;c<e.length;c++)t.has(e.charCodeAt(c))&&(r+="".concat(e.slice(a,c),"\\").concat(e.charAt(c)),a=c+1);return r.length>0?r+e.slice(a):e}exports.stringify=stringify;
