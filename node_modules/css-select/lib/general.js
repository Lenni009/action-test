"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.compileGeneralSelector=void 0;var attributes_js_1=require("./attributes.js"),index_js_1=require("./pseudo-selectors/index.js"),css_what_1=require("css-what");function getElementParent(e,t){var r=t.getParent(e);return r&&t.isTag(r)?r:null}function compileGeneralSelector(e,t,r,n,s){var a=r.adapter,o=r.equals;switch(t.type){case css_what_1.SelectorType.PseudoElement:throw new Error("Pseudo-elements are not supported by css-select");case css_what_1.SelectorType.ColumnCombinator:throw new Error("Column combinators are not yet supported by css-select");case css_what_1.SelectorType.Attribute:if(null!=t.namespace)throw new Error("Namespaced attributes are not yet supported by css-select");return r.xmlMode&&!r.lowerCaseAttributeNames||(t.name=t.name.toLowerCase()),attributes_js_1.attributeRules[t.action](e,t,r);case css_what_1.SelectorType.Pseudo:return(0,index_js_1.compilePseudoSelector)(e,t,r,n,s);case css_what_1.SelectorType.Tag:if(null!=t.namespace)throw new Error("Namespaced tag names are not yet supported by css-select");var c=t.name;return r.xmlMode&&!r.lowerCaseTags||(c=c.toLowerCase()),function(t){return a.getName(t)===c&&e(t)};case css_what_1.SelectorType.Descendant:if(!1===r.cacheResults||"undefined"==typeof WeakSet)return function(t){for(var r=t;r=getElementParent(r,a);)if(e(r))return!0;return!1};var l=new WeakSet;return function(t){for(var r=t;r=getElementParent(r,a);)if(!l.has(r)){if(a.isTag(r)&&e(r))return!0;l.add(r)}return!1};case"_flexibleDescendant":return function(t){var r=t;do{if(e(r))return!0}while(r=getElementParent(r,a));return!1};case css_what_1.SelectorType.Parent:return function(t){return a.getChildren(t).some((function(t){return a.isTag(t)&&e(t)}))};case css_what_1.SelectorType.Child:return function(t){var r=a.getParent(t);return null!=r&&a.isTag(r)&&e(r)};case css_what_1.SelectorType.Sibling:return function(t){for(var r=a.getSiblings(t),n=0;n<r.length;n++){var s=r[n];if(o(t,s))break;if(a.isTag(s)&&e(s))return!0}return!1};case css_what_1.SelectorType.Adjacent:return a.prevElementSibling?function(t){var r=a.prevElementSibling(t);return null!=r&&e(r)}:function(t){for(var r,n=a.getSiblings(t),s=0;s<n.length;s++){var c=n[s];if(o(t,c))break;a.isTag(c)&&(r=c)}return!!r&&e(r)};case css_what_1.SelectorType.Universal:if(null!=t.namespace&&"*"!==t.namespace)throw new Error("Namespaced universal selectors are not yet supported by css-select");return e}}exports.compileGeneralSelector=compileGeneralSelector;
