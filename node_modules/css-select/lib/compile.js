"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,s)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.compileToken=exports.compileUnsafe=exports.compile=void 0;var css_what_1=require("css-what"),boolbase_1=__importDefault(require("boolbase")),sort_js_1=__importStar(require("./sort.js")),general_js_1=require("./general.js"),subselects_js_1=require("./pseudo-selectors/subselects.js");function compile(e,t,r){var o=compileUnsafe(e,t,r);return(0,subselects_js_1.ensureIsTag)(o,t.adapter)}function compileUnsafe(e,t,r){return compileToken("string"==typeof e?(0,css_what_1.parse)(e):e,t,r)}function includesScopePseudo(e){return e.type===css_what_1.SelectorType.Pseudo&&("scope"===e.name||Array.isArray(e.data)&&e.data.some((function(e){return e.some(includesScopePseudo)})))}exports.compile=compile,exports.compileUnsafe=compileUnsafe;var DESCENDANT_TOKEN={type:css_what_1.SelectorType.Descendant},FLEXIBLE_DESCENDANT_TOKEN={type:"_flexibleDescendant"},SCOPE_TOKEN={type:css_what_1.SelectorType.Pseudo,name:"scope",data:null};function absolutize(e,t,r){for(var o=t.adapter,s=!!(null==r?void 0:r.every((function(e){var t=o.isTag(e)&&o.getParent(e);return e===subselects_js_1.PLACEHOLDER_ELEMENT||t&&o.isTag(t)}))),n=0,a=e;n<a.length;n++){var l=a[n];if(l.length>0&&(0,sort_js_1.isTraversal)(l[0])&&l[0].type!==css_what_1.SelectorType.Descendant);else{if(!s||l.some(includesScopePseudo))continue;l.unshift(DESCENDANT_TOKEN)}l.unshift(SCOPE_TOKEN)}}function compileToken(e,t,r){var o;e.forEach(sort_js_1.default),r=null!==(o=t.context)&&void 0!==o?o:r;var s=Array.isArray(r),n=r&&(Array.isArray(r)?r:[r]);if(!1!==t.relativeSelector)absolutize(e,t,n);else if(e.some((function(e){return e.length>0&&(0,sort_js_1.isTraversal)(e[0])})))throw new Error("Relative selectors are not allowed when the `relativeSelector` option is disabled");var a=!1,l=e.map((function(e){if(e.length>=2){var r=e[0],o=e[1];r.type!==css_what_1.SelectorType.Pseudo||"scope"!==r.name||(s&&o.type===css_what_1.SelectorType.Descendant?e[1]=FLEXIBLE_DESCENDANT_TOKEN:o.type!==css_what_1.SelectorType.Adjacent&&o.type!==css_what_1.SelectorType.Sibling||(a=!0))}return compileRules(e,t,n)})).reduce(reduceRules,boolbase_1.default.falseFunc);return l.shouldTestNextSiblings=a,l}function compileRules(e,t,r){var o;return e.reduce((function(e,o){return e===boolbase_1.default.falseFunc?boolbase_1.default.falseFunc:(0,general_js_1.compileGeneralSelector)(e,o,t,r,compileToken)}),null!==(o=t.rootFunc)&&void 0!==o?o:boolbase_1.default.trueFunc)}function reduceRules(e,t){return t===boolbase_1.default.falseFunc||e===boolbase_1.default.trueFunc?e:e===boolbase_1.default.falseFunc||t===boolbase_1.default.trueFunc?t:function(r){return e(r)||t(r)}}exports.compileToken=compileToken;
