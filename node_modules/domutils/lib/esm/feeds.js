import{textContent}from"./stringify.js";import{getElementsByTagName}from"./legacy.js";export function getFeed(e){const t=getOneElement(isValidFeed,e);return t?"feed"===t.name?getAtomFeed(t):getRssFeed(t):null}function getAtomFeed(e){var t;const n=e.children,i={type:"atom",items:getElementsByTagName("entry",n).map((e=>{var t;const{children:n}=e,i={media:getMediaElements(n)};addConditionally(i,"id","id",n),addConditionally(i,"title","title",n);const d=null===(t=getOneElement("link",n))||void 0===t?void 0:t.attribs.href;d&&(i.link=d);const a=fetch("summary",n)||fetch("content",n);a&&(i.description=a);const l=fetch("updated",n);return l&&(i.pubDate=new Date(l)),i}))};addConditionally(i,"id","id",n),addConditionally(i,"title","title",n);const d=null===(t=getOneElement("link",n))||void 0===t?void 0:t.attribs.href;d&&(i.link=d),addConditionally(i,"description","subtitle",n);const a=fetch("updated",n);return a&&(i.updated=new Date(a)),addConditionally(i,"author","email",n,!0),i}function getRssFeed(e){var t,n;const i=null!==(n=null===(t=getOneElement("channel",e.children))||void 0===t?void 0:t.children)&&void 0!==n?n:[],d={type:e.name.substr(0,3),id:"",items:getElementsByTagName("item",e.children).map((e=>{const{children:t}=e,n={media:getMediaElements(t)};addConditionally(n,"id","guid",t),addConditionally(n,"title","title",t),addConditionally(n,"link","link",t),addConditionally(n,"description","description",t);const i=fetch("pubDate",t);return i&&(n.pubDate=new Date(i)),n}))};addConditionally(d,"title","title",i),addConditionally(d,"link","link",i),addConditionally(d,"description","description",i);const a=fetch("lastBuildDate",i);return a&&(d.updated=new Date(a)),addConditionally(d,"author","managingEditor",i,!0),d}const MEDIA_KEYS_STRING=["url","type","lang"],MEDIA_KEYS_INT=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function getMediaElements(e){return getElementsByTagName("media:content",e).map((e=>{const{attribs:t}=e,n={medium:t.medium,isDefault:!!t.isDefault};for(const e of MEDIA_KEYS_STRING)t[e]&&(n[e]=t[e]);for(const e of MEDIA_KEYS_INT)t[e]&&(n[e]=parseInt(t[e],10));return t.expression&&(n.expression=t.expression),n}))}function getOneElement(e,t){return getElementsByTagName(e,t,!0,1)[0]}function fetch(e,t,n=!1){return textContent(getElementsByTagName(e,t,n,1)).trim()}function addConditionally(e,t,n,i,d=!1){const a=fetch(n,i,d);a&&(e[t]=a)}function isValidFeed(e){return"rss"===e||"feed"===e||"rdf:RDF"===e}
