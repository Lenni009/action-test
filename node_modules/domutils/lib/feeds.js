"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getFeed=void 0;var stringify_js_1=require("./stringify.js"),legacy_js_1=require("./legacy.js");function getFeed(e){var t=getOneElement(isValidFeed,e);return t?"feed"===t.name?getAtomFeed(t):getRssFeed(t):null}function getAtomFeed(e){var t,i=e.children,n={type:"atom",items:(0,legacy_js_1.getElementsByTagName)("entry",i).map((function(e){var t,i=e.children,n={media:getMediaElements(i)};addConditionally(n,"id","id",i),addConditionally(n,"title","title",i);var a=null===(t=getOneElement("link",i))||void 0===t?void 0:t.attribs.href;a&&(n.link=a);var d=fetch("summary",i)||fetch("content",i);d&&(n.description=d);var l=fetch("updated",i);return l&&(n.pubDate=new Date(l)),n}))};addConditionally(n,"id","id",i),addConditionally(n,"title","title",i);var a=null===(t=getOneElement("link",i))||void 0===t?void 0:t.attribs.href;a&&(n.link=a),addConditionally(n,"description","subtitle",i);var d=fetch("updated",i);return d&&(n.updated=new Date(d)),addConditionally(n,"author","email",i,!0),n}function getRssFeed(e){var t,i,n=null!==(i=null===(t=getOneElement("channel",e.children))||void 0===t?void 0:t.children)&&void 0!==i?i:[],a={type:e.name.substr(0,3),id:"",items:(0,legacy_js_1.getElementsByTagName)("item",e.children).map((function(e){var t=e.children,i={media:getMediaElements(t)};addConditionally(i,"id","guid",t),addConditionally(i,"title","title",t),addConditionally(i,"link","link",t),addConditionally(i,"description","description",t);var n=fetch("pubDate",t);return n&&(i.pubDate=new Date(n)),i}))};addConditionally(a,"title","title",n),addConditionally(a,"link","link",n),addConditionally(a,"description","description",n);var d=fetch("lastBuildDate",n);return d&&(a.updated=new Date(d)),addConditionally(a,"author","managingEditor",n,!0),a}exports.getFeed=getFeed;var MEDIA_KEYS_STRING=["url","type","lang"],MEDIA_KEYS_INT=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function getMediaElements(e){return(0,legacy_js_1.getElementsByTagName)("media:content",e).map((function(e){for(var t=e.attribs,i={medium:t.medium,isDefault:!!t.isDefault},n=0,a=MEDIA_KEYS_STRING;n<a.length;n++){t[r=a[n]]&&(i[r]=t[r])}for(var d=0,l=MEDIA_KEYS_INT;d<l.length;d++){var r;t[r=l[d]]&&(i[r]=parseInt(t[r],10))}return t.expression&&(i.expression=t.expression),i}))}function getOneElement(e,t){return(0,legacy_js_1.getElementsByTagName)(e,t,!0,1)[0]}function fetch(e,t,i){return void 0===i&&(i=!1),(0,stringify_js_1.textContent)((0,legacy_js_1.getElementsByTagName)(e,t,i,1)).trim()}function addConditionally(e,t,i,n,a){void 0===a&&(a=!1);var d=fetch(i,n,a);d&&(e[t]=d)}function isValidFeed(e){return"rss"===e||"feed"===e||"rdf:RDF"===e}
